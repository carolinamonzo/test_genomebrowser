<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hg38 SQANTI3 antisense Transcripts</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.6; margin: 20px; background-color: #f8f9fa; color: #212529; }
        h1, h2, h3 { color: #343a40; }
        #container { max-width: 1200px; margin: 0 auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        #filter-controls { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; margin-bottom: 25px; padding: 20px; background-color: #f1f3f5; border-radius: 6px; }
        .filter-group { display: flex; flex-direction: column; }
        label { font-weight: 500; margin-bottom: 5px; color: #495057; }
        input, select { padding: 8px 10px; border-radius: 4px; border: 1px solid #ced4da; font-size: 14px; }
        input:focus, select:focus { border-color: #80bdff; outline: 0; box-shadow: 0 0 0 0.2rem rgba(0,123,255,.25); }
        #button-container { grid-column: 1 / -1; display: flex; gap: 10px; }
        button { padding: 10px 15px; font-size: 15px; font-weight: 500; border-radius: 5px; border: none; cursor: pointer; }
        #preview-filters { background-color: #17a2b8; color: white; }
        #preview-filters:hover { background-color: #138496; }
        #apply-filters-ucsc { background-color: #28a745; color: white; }
        #apply-filters-ucsc:hover { background-color: #218838; }
        #reset-filters-ucsc { background-color: #dc3545; color: white; }
        #reset-filters-ucsc:hover { background-color: #c82333; }
        #results-count { font-size: 1.1em; font-weight: 500; margin-bottom: 15px; color: #495057; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #dee2e6; }
        thead th { background-color: #e9ecef; color: #495057; }
        tbody tr:nth-child(even) { background-color: #f8f9fa; }
        tbody tr:hover { background-color: #e2e6ea; }
    </style>
    <script>
        const transcripts = [
  {
    "isoform": "PB.8718.1",
    "exons": 3,
    "length": 4245,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "coding",
    "iso_exp": 11.351685,
    "associated_gene": "novelGene_ENSG00000100344.11_AS"
  },
  {
    "isoform": "PB.15815.1",
    "exons": 1,
    "length": 2366,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 18.5889,
    "associated_gene": "novelGene_ENSG00000223730.1_AS"
  },
  {
    "isoform": "PB.22994.1",
    "exons": 2,
    "length": 2134,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 61.938,
    "associated_gene": "novelGene_ENSG00000236499.2_AS"
  },
  {
    "isoform": "PB.45380.1",
    "exons": 1,
    "length": 1846,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 71.0206,
    "associated_gene": "novelGene_ENSG00000099937.11_AS"
  },
  {
    "isoform": "PB.45383.1",
    "exons": 1,
    "length": 1791,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 60.2701,
    "associated_gene": "novelGene_ENSG00000237476.1_AS"
  },
  {
    "isoform": "PB.53057.1",
    "exons": 1,
    "length": 1713,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 123.51665,
    "associated_gene": "novelGene_ENSG00000279345.1_AS"
  },
  {
    "isoform": "PB.68181.1",
    "exons": 1,
    "length": 1472,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 63.515550000000005,
    "associated_gene": "novelGene_ENSG00000235992.1_AS"
  },
  {
    "isoform": "PB.75694.1",
    "exons": 1,
    "length": 1318,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 69.9462,
    "associated_gene": "novelGene_ENSG00000161179.14_AS"
  },
  {
    "isoform": "PB.75781.3",
    "exons": 1,
    "length": 1177,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 31.53095,
    "associated_gene": "novelGene_ENSG00000172404.5_AS"
  },
  {
    "isoform": "PB.83195.1",
    "exons": 2,
    "length": 1020,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 264.6185,
    "associated_gene": "novelGene_ENSG00000128346.11_AS"
  },
  {
    "isoform": "PB.83241.2",
    "exons": 1,
    "length": 1085,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 0.0,
    "associated_gene": "novelGene_ENSG00000183569.18_AS"
  },
  {
    "isoform": "PB.96068.1",
    "exons": 3,
    "length": 794,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "coding",
    "iso_exp": 0.0,
    "associated_gene": "novelGene_ENSG00000286406.1_AS"
  },
  {
    "isoform": "PB.103747.1",
    "exons": 1,
    "length": 582,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 0.65745,
    "associated_gene": "novelGene_ENSG00000240591.2_AS"
  },
  {
    "isoform": "PB.103781.1",
    "exons": 1,
    "length": 577,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 311.7095,
    "associated_gene": "novelGene_ENSG00000100242.15_AS"
  },
  {
    "isoform": "PB.111550.1",
    "exons": 1,
    "length": 538,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 200.2355,
    "associated_gene": "novelGene_ENSG00000206195.11_AS"
  },
  {
    "isoform": "PB.111581.1",
    "exons": 1,
    "length": 475,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 0.0,
    "associated_gene": "novelGene_ENSG00000275004.4_AS"
  },
  {
    "isoform": "PB.111694.1",
    "exons": 2,
    "length": 376,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 0.0,
    "associated_gene": "novelGene_ENSG00000188511.12_AS"
  },
  {
    "isoform": "PB.111702.1",
    "exons": 1,
    "length": 462,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 477.9725,
    "associated_gene": "novelGene_ENSG00000100239.16_AS"
  },
  {
    "isoform": "PB.118973.1",
    "exons": 1,
    "length": 238,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 1207.155,
    "associated_gene": "novelGene_ENSG00000100201.23_AS"
  },
  {
    "isoform": "PB.119028.1",
    "exons": 2,
    "length": 351,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 183.532,
    "associated_gene": "novelGene_ENSG00000188511.12_AS"
  },
  {
    "isoform": "PB.130820.1",
    "exons": 1,
    "length": 3312,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 212.4045,
    "associated_gene": "novelGene_ENSG00000015475.19_AS"
  },
  {
    "isoform": "PB.150536.1",
    "exons": 1,
    "length": 2682,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 126.8321,
    "associated_gene": "novelGene_ENSG00000100003.18_AS_novelGene_ENSG00000249590.7_AS"
  },
  {
    "isoform": "PB.150623.1",
    "exons": 1,
    "length": 2687,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 109.8405,
    "associated_gene": "novelGene_ENSG00000100416.15_AS"
  },
  {
    "isoform": "PB.157388.1",
    "exons": 1,
    "length": 2514,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 18.93745,
    "associated_gene": "novelGene_ENSG00000233471.2_AS"
  },
  {
    "isoform": "PB.164510.1",
    "exons": 1,
    "length": 2412,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "non_coding",
    "iso_exp": 81.55449999999999,
    "associated_gene": "novelGene_ENSG00000215270.3_AS"
  },
  {
    "isoform": "PB.164521.5",
    "exons": 1,
    "length": 2356,
    "diff_to_TSS": null,
    "diff_to_TTS": null,
    "coding": "coding",
    "iso_exp": 111.6561,
    "associated_gene": "novelGene_ENSG00000236540.7_AS"
  }
];
    </script>
</head>
<body>
<div id="container">
    <h1>SQANTI3 Transcripts: antisense</h1>
    <p>This page provides interactive filtering for the <strong>26</strong> transcripts in the <strong>antisense</strong> structural category for genome <strong>hg38</strong>.</p>
    
    <div id="filter-controls">
        <div class="filter-group">
            <label for="min-exons">Min Exons</label>
            <input type="number" id="min-exons" placeholder="e.g. 1">
        </div>
        <div class="filter-group">
            <label for="max-exons">Max Exons</label>
            <input type="number" id="max-exons" placeholder="e.g. 10">
        </div>
        <div class="filter-group">
            <label for="min-tss">Min Distance to TSS</label>
            <input type="number" id="min-tss" placeholder="e.g. -10000">
        </div>
        <div class="filter-group">
            <label for="max-tss">Max Distance to TSS</label>
            <input type="number" id="max-tss" placeholder="e.g. 10000">
        </div>
        <div class="filter-group">
            <label for="coding-status">Coding Status</label>
            <select id="coding-status"><option value="all">All</option><option value="coding">coding</option><option value="non_coding">non_coding</option></select>
        </div>
        <div class="filter-group">
            <label for="gene-search">Associated Gene</label>
            <input type="text" id="gene-search" placeholder="e.g. ENSG...">
        </div>
        <div id="button-container">
            <button id="preview-filters">Preview Filters Locally</button>
            <button id="apply-filters-ucsc">Apply to Browser View</button>
            <button id="reset-filters-ucsc">Reset Browser View</button>
        </div>
    </div>
    
    <h3 id="results-count"></h3>
    <div id="results-container"></div>
</div>

<script>
    const controls = {
        minExons: document.getElementById('min-exons'),
        maxExons: document.getElementById('max-exons'),
        minTSS: document.getElementById('min-tss'),
        maxTSS: document.getElementById('max-tss'),
        coding: document.getElementById('coding-status'),
        gene: document.getElementById('gene-search')
    };

    const resultsContainer = document.getElementById('results-container');
    const resultsCount = document.getElementById('results-count');

    const urlParams = new URLSearchParams(window.location.search);
    const hgsid = urlParams.get('hgsid');
    const trackName = `hg38_sqanti3_antisense`;
    const ucscHost = 'https://genome.ucsc.edu';

    function renderTable(data) {
        if (!data || data.length === 0) {
            resultsContainer.innerHTML = '<p>No transcripts match the current filters.</p>';
            return;
        }

        let tableHTML = `
            <table>
                <thead>
                    <tr>
                        <th>Isoform</th>
                        <th>Associated Gene</th>
                        <th>Exons</th>
                        <th>Length</th>
                        <th>Diff to TSS</th>
                        <th>Diff to TTS</th>
                        <th>Coding</th>
                        <th>Isoform Exp</th>
                    </tr>
                </thead>
                <tbody>`;
        
        data.forEach(t => {
            tableHTML += `
                <tr>
                    <td>${t.isoform || 'N/A'}</td>
                    <td>${t.associated_gene || 'N/A'}</td>
                    <td>${t.exons !== null ? t.exons : 'N/A'}</td>
                    <td>${t.length !== null ? t.length : 'N/A'}</td>
                    <td>${t.diff_to_TSS !== null ? t.diff_to_TSS : 'N/A'}</td>
                    <td>${t.diff_to_TTS !== null ? t.diff_to_TTS : 'N/A'}</td>
                    <td>${t.coding || 'N/A'}</td>
                    <td>${t.iso_exp !== null ? t.iso_exp.toFixed(2) : 'N/A'}</td>
                </tr>`;
        });

        tableHTML += '</tbody></table>';
        resultsContainer.innerHTML = tableHTML;
    }

    function getFilteredIsoforms() {
        const getVal = (el) => el.value;
        const getInt = (el) => el.value ? parseInt(el.value, 10) : null;
        
        const filters = {
            minExons: getInt(controls.minExons),
            maxExons: getInt(controls.maxExons),
            minTSS: getInt(controls.minTSS),
            maxTSS: getInt(controls.maxTSS),
            coding: getVal(controls.coding),
            gene: getVal(controls.gene).toLowerCase().trim()
        };

        return transcripts.filter(t => {
            if (filters.minExons !== null && (t.exons === null || t.exons < filters.minExons)) return false;
            if (filters.maxExons !== null && (t.exons === null || t.exons > filters.maxExons)) return false;
            if (filters.minTSS !== null && (t.diff_to_TSS === null || t.diff_to_TSS < filters.minTSS)) return false;
            if (filters.maxTSS !== null && (t.diff_to_TSS === null || t.diff_to_TSS > filters.maxTSS)) return false;
            if (filters.coding !== 'all' && t.coding !== filters.coding) return false;
            if (filters.gene && (!t.associated_gene || !t.associated_gene.toLowerCase().includes(filters.gene))) return false;
            return true;
        });
    }

    function previewFilters() {
        const filteredData = getFilteredIsoforms();
        resultsCount.textContent = `Preview: Showing ${filteredData.length} of ${transcripts.length} transcripts.`;
        renderTable(filteredData);
    }

    function applyFiltersToUCSC() {
        if (!hgsid) {
            alert('This page must be opened from the UCSC Genome Browser to apply filters to the browser view.\n\n(hgsid parameter not found in URL)');
            return;
        }
        
        const filteredData = getFilteredIsoforms();
        const isoform_ids = filteredData.map(t => t.isoform);
        
        const ucscUrl = new URL(`${ucscHost}/cgi-bin/hgTracks`);
        ucscUrl.searchParams.set('hgsid', hgsid);

        if (isoform_ids.length === 0) {
            ucscUrl.searchParams.set(trackName, 'hide');
        } else {
            const filterText = isoform_ids.join(' ');
            if (filterText.length > 2000) {
                alert(`The filter is too broad (${isoform_ids.length} transcripts), resulting in a URL that is too long for the browser. Please narrow your filtering criteria.`);
                return;
            }
            ucscUrl.searchParams.set(`hg_t_${trackName}_filter`, 'on');
            ucscUrl.searchParams.set(`hg_t_${trackName}_filter_text`, filterText);
        }
        
        window.top.location.href = ucscUrl.toString();
    }

    function resetViewInUCSC() {
        if (!hgsid) {
            alert('This page must be opened from the UCSC Genome Browser to reset the view.\n\n(hgsid parameter not found in URL)');
            return;
        }

        const ucscUrl = new URL(`${ucscHost}/cgi-bin/hgTracks`);
        ucscUrl.searchParams.set('hgsid', hgsid);
        ucscUrl.searchParams.set(`hg_t_${trackName}_filter`, 'off');
        ucscUrl.searchParams.set(trackName, 'dense'); // Ensure track is visible
        
        window.top.location.href = ucscUrl.toString();
    }
    
    document.getElementById('preview-filters').addEventListener('click', previewFilters);
    document.getElementById('apply-filters-ucsc').addEventListener('click', applyFiltersToUCSC);
    document.getElementById('reset-filters-ucsc').addEventListener('click', resetViewInUCSC);

    // Initial load
    document.addEventListener('DOMContentLoaded', () => {
        resultsCount.textContent = `Showing ${transcripts.length} of ${transcripts.length} transcripts.`;
        renderTable(transcripts);
    });
</script>
</body>
</html>
